{% extends 'base.html.twig' %}
{% import "macros.html.twig" as macro %}
{% block content %}

    <a class="btn btn-primary" href="{{ path('game_index') }}"><i class="fa fa-arrow-left"></i> My Game List</a>
    {% set playlogs = game.playlogs %}
    {% set currentUserId =  app.user.id %}
    {% set gamePlayedCount = [] %}

    {% if playlogs | length > 0 %}
        {% for playlog in playlogs %}
            {#Get the playlog user_id so we count only the current user's playlogs#}
            {% set playlogUserId =  playlog.getuserid %}
            {% if playlogUserId == currentUserId %}
                {#Make an array with only the playlogs of the user and the game#}
                {% set gamePlayedCount = gamePlayedCount|merge([game.id]) %}
            {% endif %}
        {% endfor %}

    {% endif %}

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h2>Game</h2>
                <h3> {{ game.name }}</h3>

                <div class="row">
                    <div class="col-md-4">
                        <a class="btn btn-danger deleteBtn " gameId="{{ game.id }}" gameName="{{ game.name }}"
                           href=""><i class="fa fa-remove"></i> Remove
                        </a>
                        <a class="btn btn-primary"
                           href="{{ path('playlog_new', { 'gameId': game.id }) }}"> Log Play
                        </a>
                    </div>
                </div>

                <hr>
                <div class="row">
                    {% if image %}
                        <div class="col-md-4  ">
                            <img src="{{ image }}" style="width:60%; border-radius: 6px;">
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="container">
            <div class="row">
                <div class="col-md-3">
                    {{ playlogs|length }}<br>
                    <b>Plays</b>
                    <hr>
                </div>
                {% if playingTime %}
                    <div class="col-md-3">
                        {{ playingTime }} minutes<br> <b>Playing Time</b>
                        <hr>
                    </div>
                {% endif %}
                {% if minPlayers and  maxPlayers %}
                    <div class="col-md-3">
                        {{ minPlayers }}-{{ maxPlayers }}<br> <b>Players</b>
                        <hr>
                    </div>
                {% endif %}
            </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $(document).ready(function () {
            $('.deleteBtn').click(function () {
                var gameId = $(this).attr('gameId');
                var confirmText = "Are you sure you want to delete the selected game - " + gameName + " - ?";
                if (confirm(confirmText)) {
                    $.ajax({
                        type: "POST",
                        url: '{{ path('remove_user_game') }}',//path to the route of PlayLogController->deleteBulkAction method
                        data: JSON.stringify(gameId),
                        success: function () {
                            //Redirect
                            $(location).attr('href', '{{ path('game_index') }}');
                            return false;
                        },
                    });
                }
                return false;
            });
        });


    </script>
{% endblock javascripts %}